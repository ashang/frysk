2007-01-04  Mark Wielaard  <mark@klomp.org>

	Fixes frysk/3825
	* TestFCatch.java (mainThread): Add optional __ before sigsuspend
	regex match.

2007-01-02  Nurdin Premji  <npremji@redhat.com>

	* TestFCatch.java (mainThread): Added regex line to match beginning of output.

	* StressTestFStack.java: Added.
	* TestFStack.java (multiThreaded): 	Moved some variables here rather than
	global.
	Moved stressfull tests to StressTestFStack.

2006-12-27  Mike Cvet  <mcvet@redhat.com>

	* FCatch.java (trace): Removed, redundant.

2006-12-22  Nurdin Premji  <npremji@redhat.com>

	* Util.java (parsePids): Use more generic Collections Return type.
	(addConsoleOptions): Removed logger argument.
	* StacktraceAction.java (allExistingTasksCompleted): Added log message.

2006-12-22  Mike Cvet  <mcvet@redhat.com>

	* FCatch.java: Added logging.
	(init): Removed code which scanned all processes looking
	for PIDs, and directly get the Proc.
	(stackTrace): Added.
	(toString): Added.
	(getStackTrace): Added.
	(generateStackTrace): Build stack trace into the stackTrace StringBuffer.
	* TestFCatch.java: Added.

2006-12-21  Andrew Cagney  <cagney@redhat.com>

	* Util.java: Use Config's getVersion, instead of VERSION.

2006-12-21  Nurdin Premji  <npremji@redhat.com>

	* StacktraceAction.java (printTasks): Modified to use StringBuffer instead
	of LinkedLists.
	(existingTask): Use generateTaskStackTrace.
	(generateTaskStackTrace): Renamed from storeTask, made public, return
	StringBuffer.

2006-12-21  Mike Cvet  <mcvet@redhat.com>

	* FCatch.java (init): Fixed to work properly with attaching to an 
	already-running process.

2006-12-20  Mike Cvet  <mcvet@redhat.com>

	* FCatch.java: Refactored from FCrash. Committing re: #3733.
	Merged small observers together into main AttachedObserver; handles
	multiple Tasks better.

2006-12-20  Nurdin Premji  <npremji@redhat.com>

	* Util.java (addConsoleOptions): Changed the way logs are set. Now need to 
	pass LOG=LEVEL sets to set specific logs to specific levels.

2006-12-19  Nurdin Premji  <npremji@redhat.com>

	* Util.java: Ran gnu formatter.
	(parsePids): Added.
	(PidParser): Added.	

	* Util.java (addConsoleOptions): Removed short character options.
	Changed "level" to "log" option.
	
	* StacktraceAction.java (storeTask): Add logging message.

2006-12-18  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (multiThreaded.addFailed): Added.
	(testClone.addFailed): Ditto.
	* StacktraceAction.java: Made abstract
	(deletedFrom): Removed stub. 

2006-12-15  Nurdin Premji  <npremji@redhat.com>

	* Util.java (addConsoleOptions): Added.	
	* StacktraceAction.java: Revert ProcException.
	* CoredumpAction.java: Ditto.
	* TestFStack.java: Ditto.
	* TestFCore.java: Ditto.

	* StacktraceAction.java (StacktraceAction): throw ProcException	
	* CoredumpAction.java (CoredumpAction): Ditto.	
	* TestFStack.java (.execute): catch ProcException 
	(multiThreaded): Ditto.
	(testClone): Ditto.
	* TestFCore.java (.execute): Ditto.
	(constructCore): Ditto.

2006-12-14  Phil Muldoon  <pmuldoon@redhat.com>

	* CoredumpAction.java (CoredumpAction): Add new constructor for
	filename. Add writeAllMaps flag to both.
	(write_elf_file): Use getConstructedFileName() instead of
	recalculating.	Set ELF_LAYOUT mode on: construct offsets and 
	alignments manually.
	(getConstructedFileName): Get filename from fcore.java.
	(buildElfHeader): Calculate and update offset in elf file.
	(buildNotes): Ditto.
	(buildStringTable): ditto.
	(CoreMapsBuilder.buildBuffer): Create reference to raw maps.
	(CoreMapsBuilder.buildMaps): Calculate map filename.
	Check for writeAllMaps. If !writeAllMaps decided on elide
	and omit strategy. Calculate offsets to build sparse file.
	

	* TestFCore.java: Disable tests on x8664, ppc for now. Take too long.
	(constructCore): Add writeAllMaps flag.

2006-12-13  Mike Cvet  <mcvet@redhat.com>

	* StacktraceAction.java (storeTask): Update call to StackFrame.toPrint
	with false boolean.

2006-12-13  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (mainClone): Changed format of sourceFile#lineNumber
	(thread): Ditto.
	(mainThread): Ditto.

2006-12-11  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java: Stripped down regex's to just the common text between threads.
	(testClone): Re-enabled
	(testStressMultiThreadedDetach): Ditto.

2006-12-10  Andrew Cagney  <cagney@redhat.com>

	* TestFStack.java: Replace pkglibexecdir with pkglibdir.

	* TestFStack.java (testClone): Note broken - 3690.
	(testStressMultiThreadedDetach): Note broken - 3691.

2006-12-07  Phil Muldoon  <pmuldoon@redhat.com>

	* TestFCore.java: Add permShared flag.
	* CoredumpAction.java: Ditto.

2006-12-06  Andrew Cagney  <cagney@redhat.com>

	* StacktraceAction.java: Remove @author.

2006-12-06  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (mainClone): Fixed typo.

	* StracePrinter.java: Added (C).
	* TestLib.java: Ditto.
	* SyscallHandler.java: Ditto. 
	* Util.java: Ditto.

	* TestFStack.java: Another regex added.

	* TestFStack.java: Changed to use Build.SRC rather than Build.ABSSRCDIR

2006-12-05  Nurdin Premji  <npremji@redhat.com>

	* StacktraceAction.java: Renamed, was StacktraceObserver.
	(allExistingTasksCompleted): Added, required by ProcBlockAction
	(existingTask): Simplified, uses allExistingTasksCompleted when all tasks have been seen.
	* TestFStack.java (multiThreaded): StacktraceObserver renamed to StacktraceAction.
	(testClone): Ditto.
	* CoredumpAction.java (existingTask): Simplified, uses allExistingTasksCompleted.
	(allExistingTasksCompleted): Added, required by ProcBlockAction.

	* StacktraceObserver.java: ProcBlockObserver renamed to ProcBlockAction.
	* CoredumpAction.java: Ditto.
	
	* TestFStack.java (mainClone): Added sourcefile output.
	(secondaryClone): Ditto.
	(mainThread): Ditto.
	(secondaryThread): 	Ditto.

2006-12-04  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java: Added more regex's for 64 bit architectures.

2006-11-28  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (multiThreaded): Changed to use assertFindProcAndTasks.
	(testClone): Ditto.
	* TestFCore.java (giveMeAProc): Ditto.

2006-11-20  Mike Cvet  <mcvet@redhat.com>

	* FCrash.java: Removed reference to frysk.proc.ProcAttachedObserver.

2006-11-16  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (testClone): Enabled, changed to use regex arrays for easy expansion of regex.
	(mainClone): Changed to array, added more regex cases.
	(secondaryClone): Added more regex cases.
	(testMultiThreadedAckDaemon): 			
	* StacktraceObserver.java (checkFinish): Added.
	(taskAddFailed): Changed to call checkFinish.
	(existingTask): Ditto.
	(printTasks): Made private.
	(storeTask): Ditto.
	
2006-11-15  Phil Muldoon  <pmuldoon@redhat.com>
	
	* TestFCore.java: New.

	* CoredumpAction.java: New. Refactored from FCore.
	(CoredumpObserver): Added interrupt event,
	and allow the user to pass an event on termination.
	(InterruptEvent): New.
	(existingTask):Run event on last task processed.
	(buildNotes): Set header type and notes, no prog bits.
	
	* Fcore.java: Deleted.
	
	* Fcore.java (main): Deleted.
	(addOptions): Deleted.
	(CoredumpObserver): Renamed.

2006-11-14  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (fillENoteSection): Fix double PRSTATUS
	writes on FP Registers. Clean up, and comment.
	(buildElfHeader): Added missed arch classes.
	(fillENotePrstatus): Added LinuxIa32On64 case for registers.

2006-11-13  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (CoreMapsBuilder.buildMap): Comment out maps writing
	strategy for now.

2006-11-10  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (fillENoteFPRegSet): New.
	(fillENoteSection): Add fillENoteFPRegSet call.

2006-11-09  Nurdin Premji  <npremji@redhat.com>

	* StacktraceObserver.java: Changed back to StringBuffer, just as fast as String
	and would be faster for very large stacktraces. (Previous 40% boost shown to be a fluke).

2006-11-08  Andrew Cagney  <cagney@redhat.com>

	* TestFStack.java (testClone): Mark as broken, ref 3492.

2006-11-07  Nurdin Premji  <npremji@redhat.com>

	* StacktraceObserver: Switched to use String rather than StringBuffer.
	Testcases show 40% improvement.

2006-11-06  Nurdin Premji  <npremji@edhat.com>

	* TestFStack.java: Ran GNU Formatter. 
	(secondaryClone): Changed to use an array for easy updating of regex.
	(testClone): Ditto.	
	* StacktraceObserver.java: Ran gnu formatter
	(taskAddFailed): Changed from taskRemoved.

2006-11-03  Nurdin Premji  <npremji@edhat.com>

	* TestFStack.java (secondaryThread): Changed to array to hold all different
	regexs of a secondary thread.
	(testClone): Added.
	(secondaryCloneB): Added.
	(mainThread): Changed to array to hold multiple regexs.
	(multiThreaded): Changed to use arrays.
	(mainClone): Changed.
	(secondaryClone): Changed.	
	* StacktraceObserver.java (existingTask): Changed back to use full list of tasks and 
	remove as tasks are handled.
	(taskRemoved): Ditto.
	(StacktraceObserver): Ditto. 

2006-11-02  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (testStressMultiThreadedDetach): Removed thrown IOException
	(testMultiThreadedAckDaemon): Ditto.
	(testSingleThreadedDetached): Ditto.
	(multiThreaded): Ditto.
	(testSingleThreadedAckDaemon): Ditto.
	(testMultiThreadedDetached): Ditto.
	
	(testMultiThreadedAckDaemon): Changed regex.
	(testStressMultiThreadedDetach): Ditto.
	(testSingleThreadedDetached): Ditto.
	(testSingleThreadedAckDaemon): Ditto.
	(testMultiThreadedDetached): Ditto.
	(mainThreadB): Added.
	(multiThreaded): Changed regex
	(mainClone): Added.
	(secondaryClone): Added.
	(secondaryThreadB): Added.

2006-11-01  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (multiThreaded): Changed to reflect StacktraceObserver using a StringBuffer
	rather than a PrintWriter.
	(mainThread): Ditto.
	(secondaryThread): 	Ditto.
	* StacktraceObserver.java: Added (C).
	(StacktraceObserver): Changed to use StringBuffer rather than PrintWriter. 
	(printTasks): Ditto.
	(existingTask): Changed to append tasks to an empty list instead of removing them 
	from a full list.
	(taskRemoved): Added
	(storeTask): Used StackFrame.toPrint() method.
	(toPrint): Added
	(InterruptEvent): Added, allows Ctrl-C exiting.

2006-10-27  Nurdin Premji <npremji@redhat.com>

	* StacktraceObserver: Added, replaces:
	* FStack.java: Removed.
	* TestFStack: Changed to use StacktraceObserver.

2006-10-27  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (fillENoteAuxv): New.
	(fillENoteSection): Added AuxV call.

2006-10-26  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (Analyzer): Added, new thread to analyze the output from fstack.
	(testMultiThreadedAckDaemon): Changed bug # to appropriate bug.
	(testSingleThreadedDetached): Ditto.
	(testStressMultiThreadedDetach): Ditto.
	(testSingleThreadedAckDaemon): Ditto. 
	(testMultiThreadedDetached): Ditto.
	(multiThreaded): Changed to use Analyzer thread to analyze output, avoids hangs due to
	full PipedWriter.
	
	* FStack.java:
	(printTasks): Added logging.
	(StackTasksObserver.addFailed): Removed, use default ProcBlockObserver addFailed method.
	(scheduleStackAndRunEvent): Changed system exit from -1 to +1.
	(StackTasksObserver.existingTask): Added logging.
	* TestFStack.java:
	(testStressMultiThreadedDetach): Removed broken's, caused by TestStackBacktrace.
	(testMultiThreadedAckDaemon): Ditto.
	(testSingleThreadedDetached): Ditto.
	(testSingleThreadedAckDaemon): Ditto.
	(testMultiThreadedDetached): Ditto.

2006-10-25  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java (multiThreaded): Changed to use methods FStack.scheduleStackAndRunEvent
	and Proc.requestAbandonAndRunEvent.	
	* FStack.java (StackTasksObserver.StackTasksObserver): Added event parameter, to run an event after
	stack trace is printed. 
	(StackTasksObserver.existingTask): 	Changed to run a given event rather than abandon the process.
	(scheduleStackAndRunEvent): Added.
	(scheduleStack): Removed.
	(removeObservers): Removed, should be handled elsewhere since fstack might want a quick detach.
	While other programs might want a simple removal.

2006-10-24  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (run): Convert to using ProcBlockObserver.
	(CoreDumpTasksObserver): Rebase on ProcBlockObserver.

2006-10-24  Mike Cvet  <mcvet@redhat.com>

	* FCrash.java (.update): Changed TasksCrashObserver to iterating
	through Tasks and adding AttachedObserver.
	(TasksCrashObserver): Removed.

2006-10-24  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java: Ran GNU Formatter
	(secondaryThread): Added.
	(testMultiThreadedAckDaemon): Added.
	(testSingleThreadedDetached): Changed to use multiThreaded.
	(testStressMultiThreadedDetach): Added.
	(testSingleThreadedAckDaemon): Changed to use multiThreaded.
	(mainThread): Moved out of testSingleThreadedDetached.
	(testMultiThreadedDetached): 
	(multiThreaded): Added.	
	* FStack.java: Ran GNU Formatter. 
	(StackTasksObserver): Changed to use ProcBlockObserver.
	(scheduleStack): Changed to use ProcBlockObserver
	
2006-10-24  Andrew Cagney  <cagney@redhat.com>

	* TestFStack.java (testSingleThreadedAckDaemon): Mark as broken; 3420.

2006-10-24  Yong Zheng  <zhengyo@cn.ibm.com>

	* FCore.java (fillENotePrstatus): Add one register map array for 
	32-bit case on PPC64 and remove the "mq" register.

2006-10-23  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (abandonCoreDump): New.
	(CoreDumpTasksObserver): GNU Indent. Add comments.
	(CoreDumpTasksObserver.existingTask): Call abandonCoreDump, on each
	Exception case.
	(CoreDumpTasksObserver.removeObservers): Use proc.requestAbandon().
	(fillENotePrstatus): GNU Indent. Use abandonCoreDump on failure.
	(fillENotePrpsinfo, constructSectionData): GNU Indent.
	(fillENoteSection): Added JavaDoc. GNU Indent.
	(write_elf_file): Rewritten and broken up into smaller utility 
	functions.
	(buildElfHeader): New. Extrapolated from write_elf_file.
	(buildNotes): Ditto.
	(buildStringTable): Ditto.
	(CoreMapsBuilder.buildMap): GNU Indent.
	(MapsCounter.buildMap): Ditto.
	(main): GNU Indent and clean-up.
	(addOptions): GNU Indent and clean-up.

2006-10-23  Mike Cvet  <mcvet@redhat.com>

	* FCrash.java (SignalObserver.updateSignaled): Added switch to
	catch multiple signals.
	(generateStackTrace): Added.

2006-10-23  Yong Zheng  <zhengyo@cn.ibm.com>

	* FCore.java (fillENotePrstatus): Set registers for PPC/PPC64.
	(fillENotePrpsinfo): Modify the end index of the byte[]. 

2006-10-22  Mike Cvet  <mcvet@redhat.com>

	* FCrash.java (trace): Create the new proc with an 
	AttachedObserver rather than a ProcAttachedObserver.
	(handleTask): Listen for signals to fcrash.
	(TasksCrashObserver): Removed unneeded constructor..
	(AttachedObserver): Added.
	(AttachedObserver.updateAttached): Create new SignalObserver
	for task.
	(SignalObserver): Added.
	
2006-10-22  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (fillENotePrstatus): New. Write PRSTATUS note
	for i386/x86_64. 
	(fillENoteSection): Add in PRSTATUS, and loop for each thread.

2006-10-20  Mike Cvet  <mcvet@redhat.com>

	* FCrash.java: Added.

2006-10-20  Nurdin Premji  <npremji@redhat.com>

	* TestFStack.java: Added.
	* FStack.java (scheduleStack): Added permission check.
	* TestLib.java: Added.	


2006-10-20  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (run): Add permission check, before core dumping.

2006-10-20  Yong Zheng  <zhengyong@cn.ibm.com>

	* FCore.jav (fillENotePrpsinfo): Pass pid as one parameter when refreshing Stat.
	(postProcessElfFile): Support modifications of the e_type in ELF 
	header on big-endian platform.

2006-10-19  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (write_elf_file): Request a elf section notes update
	after NOTES section data is complete. Refetch the notes section header
	after elf_update. Reformat to GNU Style.
	(postProcessElfFile): Reformat to GNU Style.
	(fillENoteSection): Rename sectionDate -> sectionData.
	(fillENotePrpsinfo): Use Proc.get{UID|PID} instead of Stat.get{UID|GID}
	Use Proc.getParent().getPid() to find parent instead of Stat.ppid.
	Use Proc.getCommand() instead of Stat.comm.
	
2006-10-19  Nurdin Premji  <npremji@redhat.com>
	
	* FStack.java (StackTasksObserver.addFailed): Removed TODO message.
	(scheduleStack (int)): Renamed, was run.
	(scheduleStack (Proc)): Added. 	Don't start eventLoop here.

2006-10-19  Yong Zheng  <zhengyo@cn.ibm.com>

	* FCore.java (fillENoteSection): New function to construct PT_NOTE section).
	(constructSectionData): New function to construct PT_NOTE data.
	(fillENotePrpsinfo): New function to fill elf_prpsinfo info.

2006-10-18  Nurdin Premji  <npremji@redhat.com>

	* FStack.java (removeObservers): Refactored proc.requestRemoveAllObservers to proc.requestAbandon.

	* FStack.java (StackTasksObserver.deletedFrom):  Removed hidden print statements.

2006-10-17  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (write_elf_file): Specify wordsize on elf header creation.
	Call postProcess to change elf core file.
	(postProcessElfFile): New. Change ET_EXEC -> ET_CORE. See bz sw 3373.

2006-10-16  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java (CoreMapsBuilder.buildMap): Fix numOfMaps incorrect count.
	(write_elf_file): Removed stray shtrndx assignment.

2006-10-15  Phil Muldoon  <pmuldoon@redhat.com>

	* frysk/util/FCore.java ((FCore.CoreMapsBuilder): Fixed program segment
	alignments and offsets (match sections).

	* frysk/util/FCore.java (write_elf_file): Rewritten with these changes:
	- Build elf header manually with full complement of data. 
	- Build string table section/section header and update to disk. 
	- (Still) Ugly arch test hack.
	(CoreMapsBuilder.buildMap): 
	* frysk/util/FCore.java (FCore.MapsCounter): Renamed.
	* frysk/util/FCore.java (FCore.CoreMapsBuilder): Renamed.
	(buildMap):Rewritten with these changes: 
	- build section headers
	- define section headers in concert with program headers.
	- build section from header, create contextual Elf_Data class, and 
	byte copy maps data.

2006-10-13  Andrew Cagney  <cagney@redhat.com>

	* FStack.java: Coding nit, remove false== and null==.

2006-10-13  Nurdin Premji  <npremji@redhat.com>

	* FStack.java (removeObservers): Changed to use 
	proc.removeAllObservations.

2006-10-13  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java: Added a patch by Yong Zheng  <zhengyo@cn.ibm.com> 
	that writes out p_flags/p_filez for each entry.

2006-10-12  Phil Muldoon  <pmuldoon@redhat.com>

	* FCore.java: Added. Initial, experimental and incomplete utility to
	dump process core in frysk.

2006-10-06  Tom Tromey  <tromey@redhat.com>

	* Ftrace.java: Added.
	* StracePrinter.java: Added.
	* SyscallHandler.java: Added.
	* Util: Added.

2006-10-06  Nurdin Premji <npremji@redhat.com>

	* FStack.java: Added.


Local Variables:
mode: change-log
left-margin: 8
fill-column: 74
version-control: never
End:
