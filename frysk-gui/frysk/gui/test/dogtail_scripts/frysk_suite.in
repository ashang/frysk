#! /bin/bash
#
# Temporary shell script
#
# As of June 8, 2006, there's a problem with 
# the test suite - either Frysk or Dogtail gets confused and attempts
# to run tests before other tests have completed - short-term workaround
# is to comment out these lines, run the tests separately, and read
# the datafiles from the CLI       

# Is accessability enabled?

accessibility=`gconftool-2 --get /desktop/gnome/interface/accessibility`
if test "$accessibility" = false ; then
    cat <<EOF 1>&2
Your machine does not have accessability enabled, enter:
    gconftool-2 --type bool --set /desktop/gnome/interface/accessibility true
to enable it.
EOF
    exit 77
fi

frysk=@abs_builddir@/frysk/gui/FryskGui
src=@abs_srcdir@/frysk/gui/test/dogtail_scripts
funitchild=@abs_builddir@/frysk-core/frysk/pkglibexecdir/funit-child

cat <<EOF | grep -v '#' | while read script args ; do
#
# Tests that should pass
${src}/TestCredits.py ${src}/another_new_session.xml
${src}/TestLicense.py ${src}/another_new_session.xml
${src}/TestCreateObserversfromDataModel.py ${src}/another_new_session.xml ${src}/new_fork_custom_observer.xml
${src}/TestCreateObserversfromDataModel.py ${src}/another_new_session.xml ${src}/new_syscall_custom_observer.xml
${src}/TestCreateObserversfromDataModel.py ${src}/another_new_session.xml ${src}/new_task_clone_custom_observer.xml
${src}/TestCreateObserversfromDataModel.py ${src}/another_new_session.xml ${src}/new_task_term_custom_observer.xml
${src}/TestCreateObserversfromDataModel.py ${src}/another_new_session.xml ${src}/new_exec_custom_observer.xml
${src}/TestDruid.py ${src}/another_new_session.xml
${src}/TestEventViewerButtons.py ${src}/another_new_session.xml
${src}/TestEventViewerMarkers.py ${src}/another_new_session.xml
#
# Tests that currently fail - commented out
# bug 2866 ${src}/Test2866.py ${src}/another_new_session.xml
# bug 2807 ${src}/TestStressDruid.py ${src}/another_new_session.xml
#
# Tests for resolved bugs - run these tests to prevent regressions
${src}/TestCredits.py ${src}/Test2921.xml
${src}/Test2985.py ${src}/funit_new_session.xml
#
EOF
    echo Running: ${script}
    if python ${script} ${frysk} ${funitchild} ${args} ; then
	:
    else
	echo "Failing ${script}"
	exit 1
    fi
done || exit 1
